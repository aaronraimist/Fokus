/*!
 * Fokus 0.5
 * http://lab.hakim.se/fokus
 * MIT licensed
 *
 * Copyright (C) 2012 Hakim El Hattab, http://hakim.se
 */
chrome.storage.sync.get(["fokusOpacity","fokusModifier","fokusPadding"],function(a){(function(){var g=a.fokusPadding?parseFloat(a.fokusPadding):5;
var u=a.fokusOpacity?parseFloat(a.fokusOpacity):0.75;var e=a.fokusModifier;var z,y,w=0,p,c={left:0,top:0,right:0,bottom:0},i={left:0,top:0,right:0,bottom:0},q={ctrl:false,shift:false,alt:false,cmd:false};
function d(){if(l()&&!window.__fokused){window.__fokused=true;z=document.createElement("canvas");y=z.getContext("2d");z.style.position="fixed";z.style.left=0;
z.style.top=0;z.style.zIndex=2147483647;z.style.pointerEvents="none";document.addEventListener("mousedown",n,false);document.addEventListener("keyup",s,false);
document.addEventListener("keydown",s,false);document.addEventListener("scroll",m,false);document.addEventListener("DOMMouseScroll",m,false);window.addEventListener("resize",f,false);
f();}}function l(){return !!("addEventListener" in document&&"pointerEvents" in document.body.style);}function v(){var A=x();y.clearRect(0,0,z.width,z.height);
y.fillStyle="rgba( 0, 0, 0, "+w+" )";y.fillRect(0,0,z.width,z.height);if(A){if(w<0.1){i=c;}else{i.left+=(c.left-i.left)*0.18;i.top+=(c.top-i.top)*0.18;
i.right+=(c.right-i.right)*0.18;i.bottom+=(c.bottom-i.bottom)*0.18;}}y.clearRect(i.left-window.scrollX-g,i.top-window.scrollY-g,(i.right-i.left)+(g*2),(i.bottom-i.top)+(g*2));
if(A){w+=(u-w)*0.08;}else{w=Math.max((w*0.85)-0.02,0);}cancelAnimationFrame(p);if(A||w>0){if(!z.parentNode){document.body.appendChild(z);}p=requestAnimationFrame(v);
}else{document.body.removeChild(z);}}function t(B){var D={left:Number.MAX_VALUE,top:Number.MAX_VALUE,right:0,bottom:0};var A=o();for(var E=0,H=A.length;
E<H;E++){var C=A[E];if(C.nodeName==="#text"&&C.nodeValue.trim()){C=C.parentNode;}var G=b(C);var J=G.x,I=G.y,K=C.offsetWidth,F=C.offsetHeight;if(C&&typeof J==="number"&&typeof K==="number"&&(K>0||F>0)&&!C.nodeName.match(/^br$/gi)){D.left=Math.min(D.left,J);
D.top=Math.min(D.top,I);D.right=Math.max(D.right,J+K);D.bottom=Math.max(D.bottom,I+F);}}if(!e||e==="none"||q[e]||x()){c=D;}if(B){i=c;}if(x()){v();}}function x(){return c.left<c.right&&c.top<c.bottom;
}function n(A){if(A.which!==3){document.addEventListener("mousemove",r,false);document.addEventListener("mouseup",j,false);t();}}function r(A){t();}function j(A){document.removeEventListener("mousemove",r,false);
document.removeEventListener("mouseup",j,false);setTimeout(t,1);}function s(A){q.alt=A.altKey||A.altGraphKey;q.ctrl=A.ctrlKey;q.shift=A.shiftKey;q.meta=A.metaKey;
t();}function m(A){t(true);}function f(A){z.width=window.innerWidth;z.height=window.innerHeight;}function o(){if(window.getSelection){var A=window.getSelection();
if(!A.isCollapsed){return k(A.getRangeAt(0));}}return[];}function k(B){var C=B.startContainer;var A=B.endContainer;if(C==A){if(C.nodeName==="#text"){return[C.parentNode];
}return[C];}var D=[];while(C&&C!=A){D.push(C=h(C));}C=B.startContainer;while(C&&C!=B.commonAncestorContainer){D.unshift(C);C=C.parentNode;}return D;}function h(A){if(A.hasChildNodes()){return A.firstChild;
}else{while(A&&!A.nextSibling){A=A.parentNode;}if(!A){return null;}return A.nextSibling;}}function b(B){var A=document.documentElement.offsetLeft,C=document.documentElement.offsetTop;
if(B.offsetParent){do{A+=B.offsetLeft;C+=B.offsetTop;}while(B=B.offsetParent);}return{x:A,y:C};}(function(){var B=0;var C=["ms","moz","webkit","o"];for(var A=0;
A<C.length&&!window.requestAnimationFrame;++A){window.requestAnimationFrame=window[C[A]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[C[A]+"CancelAnimationFrame"]||window[C[A]+"CancelRequestAnimationFrame"];
}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(H,E){var D=new Date().getTime();var F=Math.max(0,16-(D-B));var G=window.setTimeout(function(){H(D+F);
},F);B=D+F;return G;};}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(D){clearTimeout(D);};}}());d();})();});